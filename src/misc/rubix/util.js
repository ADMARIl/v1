var U = [[0, 6], [1, 3], [2, 0], [3, 7], [4, 4], [5, 1], [6, 8], [7, 5], [8, 2], [15, 26], [16, 23], [17, 20], [27, 15], [30, 16], [33, 17], [47, 27], [46, 30], [45, 33], [26, 47], [23, 46], [20, 45]];
var F = [[45, 51], [46, 48], [47, 45], [48, 52], [49, 49], [50, 46], [51, 53], [52, 50], [53, 47], [6, 24], [7, 25], [8, 26], [33, 6], [34, 7], [35, 8], [24, 42], [25, 43], [26, 44], [42, 33], [43, 34], [44, 35]];
var L = [[18, 24], [19, 21], [20, 18], [21, 25], [22, 22], [23, 19], [24, 26], [25, 23], [26, 20], [0, 9], [3, 12], [6, 15], [45, 0], [48, 3], [51, 6], [9, 44], [12, 41], [15, 38], [38, 51], [41, 48], [44, 45]];
var R = [[27, 33], [28, 30], [29, 27], [30, 34], [31, 31], [32, 28], [33, 35], [34, 32], [35, 29], [36, 17], [39, 14], [42, 11], [2, 47], [5, 50], [8, 53], [11, 2], [14, 5], [17, 8], [47, 42], [50, 39], [53, 36]];
var D = [[36, 42], [37, 39], [38, 36], [39, 43], [40, 40], [41, 37], [42, 44], [43, 41], [44, 38], [29, 53], [32, 52], [35, 51], [18, 11], [21, 10], [24, 9], [9, 29], [10, 32], [11, 35], [51, 18], [52, 21], [53, 24]];
var B = [[9, 15], [10, 12], [11, 9], [12, 16], [13, 13], [14, 10], [15, 17], [16, 14], [17, 11], [0, 27], [1, 28], [2, 29], [18, 0], [19, 1], [20, 2], [27, 36], [28, 37], [29, 38], [36, 18], [37, 19], [38, 20]];
var Ui = [[6, 0], [3, 1], [0, 2], [7, 3], [4, 4], [1, 5], [8, 6], [5, 7], [2, 8], [26, 15], [23, 16], [20, 17], [15, 27], [16, 30], [17, 33], [27, 47], [30, 46], [33, 45], [47, 26], [46, 23], [45, 20]];
var Fi = [[51, 45], [48, 46], [45, 47], [52, 48], [49, 49], [46, 50], [53, 51], [50, 52], [47, 53], [24, 6], [25, 7], [26, 8], [6, 33], [7, 34], [8, 35], [42, 24], [43, 25], [44, 26], [33, 42], [34, 43], [35, 44]];
var Li = [[24, 18], [21, 19], [18, 20], [25, 21], [22, 22], [19, 23], [26, 24], [23, 25], [20, 26], [9, 0], [12, 3], [15, 6], [0, 45], [3, 48], [6, 51], [44, 9], [41, 12], [38, 15], [51, 38], [48, 41], [45, 44]];
var Ri = [[33, 27], [30, 28], [27, 29], [34, 30], [31, 31], [28, 32], [35, 33], [32, 34], [29, 35], [17, 36], [14, 39], [11, 42], [47, 2], [50, 5], [53, 8], [2, 11], [5, 14], [8, 17], [42, 47], [39, 50], [36, 53]];
var Di = [[42, 36], [39, 37], [36, 38], [43, 39], [40, 40], [37, 41], [44, 42], [41, 43], [38, 44], [53, 29], [52, 32], [51, 35], [11, 18], [10, 21], [9, 24], [29, 9], [32, 10], [35, 11], [18, 51], [21, 52], [24, 53]];
var Bi = [[15, 9], [12, 10], [9, 11], [16, 12], [13, 13], [10, 14], [17, 15], [14, 16], [11, 17], [27, 0], [28, 1], [29, 2], [0, 18], [1, 19], [2, 20], [36, 27], [37, 28], [38, 29], [18, 36], [19, 37], [20, 38]];
var M = [[1, 10], [4, 13], [7, 16], [10, 43], [13, 40], [16, 37], [46, 1], [49, 4], [52, 7], [37, 52], [40, 49], [43, 46]];
var E = [[48, 19], [49, 22], [50, 25], [28, 50], [31, 49], [34, 48], [12, 28], [13, 31], [14, 34], [19, 14], [22, 13], [25, 12]];
var S = [[3, 21], [4, 22], [5, 23], [21, 39], [22, 40], [23, 41], [30, 3], [31, 4], [32, 5], [39, 30], [40, 31], [41, 32]];
var Mi = [[10, 1], [13, 4], [16, 7], [43, 10], [40, 13], [37, 16], [1, 46], [4, 49], [7, 52], [52, 37], [49, 40], [46, 43]];
var Ei = [[19, 48], [22, 49], [25, 50], [50, 28], [49, 31], [48, 34], [28, 12], [31, 13], [34, 14], [14, 19], [13, 22], [12, 25]];
var Si = [[21, 3], [22, 4], [23, 5], [39, 21], [40, 22], [41, 23], [3, 30], [4, 31], [5, 32], [30, 39], [31, 40], [32, 41]];
var X = [[27, 33], [28, 30], [29, 27], [30, 34], [31, 31], [32, 28], [33, 35], [34, 32], [35, 29], [36, 17], [39, 14], [42, 11], [2, 47], [5, 50], [8, 53], [11, 2], [14, 5], [17, 8], [47, 42], [50, 39], [53, 36], [24, 18], [21, 19], [18, 20], [25, 21], [22, 22], [19, 23], [26, 24], [23, 25], [20, 26], [9, 0], [12, 3], [15, 6], [0, 45], [3, 48], [6, 51], [44, 9], [41, 12], [38, 15], [51, 38], [48, 41], [45, 44], [10, 1], [13, 4], [16, 7], [43, 10], [40, 13], [37, 16], [1, 46], [4, 49], [7, 52], [52, 37], [49, 40], [46, 43]];
var Y = [[0, 6], [1, 3], [2, 0], [3, 7], [4, 4], [5, 1], [6, 8], [7, 5], [8, 2], [15, 26], [16, 23], [17, 20], [27, 15], [30, 16], [33, 17], [47, 27], [46, 30], [45, 33], [26, 47], [23, 46], [20, 45], [42, 36], [39, 37], [36, 38], [43, 39], [40, 40], [37, 41], [44, 42], [41, 43], [38, 44], [53, 29], [52, 32], [51, 35], [11, 18], [10, 21], [9, 24], [29, 9], [32, 10], [35, 11], [18, 51], [21, 52], [24, 53], [19, 48], [22, 49], [25, 50], [50, 28], [49, 31], [48, 34], [28, 12], [31, 13], [34, 14], [14, 19], [13, 22], [12, 25]];
var Z = [[45, 51], [46, 48], [47, 45], [48, 52], [49, 49], [50, 46], [51, 53], [52, 50], [53, 47], [6, 24], [7, 25], [8, 26], [33, 6], [34, 7], [35, 8], [24, 42], [25, 43], [26, 44], [42, 33], [43, 34], [44, 35], [15, 9], [12, 10], [9, 11], [16, 12], [13, 13], [10, 14], [17, 15], [14, 16], [11, 17], [27, 0], [28, 1], [29, 2], [0, 18], [1, 19], [2, 20], [36, 27], [37, 28], [38, 29], [18, 36], [19, 37], [20, 38], [3, 21], [4, 22], [5, 23], [21, 39], [22, 40], [23, 41], [30, 3], [31, 4], [32, 5], [39, 30], [40, 31], [41, 32]];
var Xi = [[33, 27], [30, 28], [27, 29], [34, 30], [31, 31], [28, 32], [35, 33], [32, 34], [29, 35], [17, 36], [14, 39], [11, 42], [47, 2], [50, 5], [53, 8], [2, 11], [5, 14], [8, 17], [42, 47], [39, 50], [36, 53], [18, 24], [19, 21], [20, 18], [21, 25], [22, 22], [23, 19], [24, 26], [25, 23], [26, 20], [0, 9], [3, 12], [6, 15], [45, 0], [48, 3], [51, 6], [9, 44], [12, 41], [15, 38], [38, 51], [41, 48], [44, 45], [1, 10], [4, 13], [7, 16], [10, 43], [13, 40], [16, 37], [46, 1], [49, 4], [52, 7], [37, 52], [40, 49], [43, 46]];
var Yi = [[6, 0], [3, 1], [0, 2], [7, 3], [4, 4], [1, 5], [8, 6], [5, 7], [2, 8], [26, 15], [23, 16], [20, 17], [15, 27], [16, 30], [17, 33], [27, 47], [30, 46], [33, 45], [47, 26], [46, 23], [45, 20], [36, 42], [37, 39], [38, 36], [39, 43], [40, 40], [41, 37], [42, 44], [43, 41], [44, 38], [29, 53], [32, 52], [35, 51], [18, 11], [21, 10], [24, 9], [9, 29], [10, 32], [11, 35], [51, 18], [52, 21], [53, 24], [48, 19], [49, 22], [50, 25], [28, 50], [31, 49], [34, 48], [12, 28], [13, 31], [14, 34], [19, 14], [22, 13], [25, 12]];
var Zi = [[51, 45], [48, 46], [45, 47], [52, 48], [49, 49], [46, 50], [53, 51], [50, 52], [47, 53], [24, 6], [25, 7], [26, 8], [6, 33], [7, 34], [8, 35], [42, 24], [43, 25], [44, 26], [33, 42], [34, 43], [35, 44], [9, 15], [10, 12], [11, 9], [12, 16], [13, 13], [14, 10], [15, 17], [16, 14], [17, 11], [0, 27], [1, 28], [2, 29], [18, 0], [19, 1], [20, 2], [27, 36], [28, 37], [29, 38], [36, 18], [37, 19], [38, 20], [21, 3], [22, 4], [23, 5], [39, 21], [40, 22], [41, 23], [3, 30], [4, 31], [5, 32], [30, 39], [31, 40], [32, 41]];

var WHITE = 0, RED = 1, BLUE = 2, GREEN = 3, YELLOW = 4, ORANGE = 5;
var UP = 0, BACK = 1, LEFT = 2, RIGHT = 3, DOWN = 4, FRONT = 5;

var colors = ["white", "red", "blue", "green", "yellow", "orange"];

function updateDisplay() {
  for (var i = 0; i < 54; i++) {
    if (cube[i] == WHITE && i % 9 == 4) {
      document.getElementById("square_" + i).setAttribute("class", colors[cube[i]] + " whiteCenter");
    } else {
    document.getElementById("square_" + i).setAttribute("class", colors[cube[i]]);
    }
  }
}

function turns(sets, count) {
  if (typeof count === "undefined") count = 1;
  for (var c = 0; c < count; c++) {
    for (var key in sets) {
      turn(sets[key]);
    }
  }
}

function turn(set, count) {
  logTurn(set, count);
  if (typeof count === "undefined") count = 1;
  for (var c = 0; c < count; c++) {
    var newCube = [];
    for (var i = 0; i < 54; i++) {
      newCube[i] = cube[i];
    }
    for (var i = 0; i < set.length; i++) {
      newCube[set[i][0]] = cube[set[i][1]];
    }
    cube = newCube;
  }
  updateDisplay();
}

var bold = " font-weight: bold; ", italic = " font-style: italic; ", light = " opacity: .5; ", clear = "__clear__";
function log(line, style) {
  if (!LOGGING) return;
  if (line == "__clear__") document.getElementById("solve_steps").innerHTML = ""; 
  else {
    if (!document.getElementById("solve_steps").innerHTML.endsWith("<br />")) document.getElementById("solve_steps").innerHTML += "<br />";
    document.getElementById("solve_steps").innerHTML += "<span style='" + style + "'>" + line + "</span><br />";
  }
}

function logTurn(set, count) {
  
  var move = "";
  if (arrayCompare(set, U)) move = "U"; 
  if (arrayCompare(set, D)) move = "D"; 
  if (arrayCompare(set, L)) move = "L"; 
  if (arrayCompare(set, R)) move = "R"; 
  if (arrayCompare(set, F)) move = "F"; 
  if (arrayCompare(set, B)) move = "B"; 
  if (arrayCompare(set, Ui)) move = "U'"; 
  if (arrayCompare(set, Di)) move = "D'"; 
  if (arrayCompare(set, Li)) move = "L'"; 
  if (arrayCompare(set, Ri)) move = "R'"; 
  if (arrayCompare(set, Fi)) move = "F'"; 
  if (arrayCompare(set, Bi)) move = "B'"; 
  if (arrayCompare(set, M)) move = "M"; 
  if (arrayCompare(set, E)) move = "E"; 
  if (arrayCompare(set, S)) move = "S"; 
  if (arrayCompare(set, Mi)) move = "M'"; 
  if (arrayCompare(set, Ei)) move = "E'"; 
  if (arrayCompare(set, Si)) move = "S'"; 
  if (arrayCompare(set, X)) move = "X"; 
  if (arrayCompare(set, Y)) move = "Y"; 
  if (arrayCompare(set, Z)) move = "Z"; 
  if (arrayCompare(set, Xi)) move = "X'"; 
  if (arrayCompare(set, Yi)) move = "Y'"; 
  if (arrayCompare(set, Zi)) move = "Z'";
  if (typeof count === "undefined") count = 1;
  for (var c = 0; c < count; c++) {
    document.getElementById("solve_steps").innerHTML += "<span style='font-weight: bold; font-size: 1.3em;'>" + move + "</span>&nbsp;&nbsp;";
  }
}

var cube = [
  WHITE, BLUE, WHITE, BLUE, RED, GREEN, ORANGE, WHITE, GREEN, // U - white
  ORANGE, ORANGE, ORANGE, RED, WHITE, YELLOW, GREEN, RED, BLUE, // B - red
  BLUE, GREEN, RED, GREEN, GREEN, WHITE, YELLOW, YELLOW, GREEN, // L - blue
  RED, RED, YELLOW, WHITE, BLUE, RED, RED, ORANGE, BLUE, // R - green
  GREEN, BLUE, WHITE, WHITE, ORANGE, ORANGE, ORANGE, BLUE, BLUE, // D - yellow
  WHITE, ORANGE, YELLOW, GREEN, YELLOW, YELLOW, RED, YELLOW, YELLOW // F - orange
];

function getFaceByCenterColor(color) {
  for (var i = 0; i < 6; i++) {
    if (cube[4 + i * 9] == color) {
      return i;
    }
  }
}

var CUBIE = {
  center : {
    U : [4],
    B : [13], 
    L : [22],
    R : [31],
    D : [40],
    F : [49]
  },
  edge : {
    UB : [1,16],
    UL : [3,23],
    UR : [5,30],
    UF : [7,46],
    DB : [37,10],
    DL : [41,21],
    DR : [39,32],
    DF : [43,52],
    FL : [48,25],
    FR : [50,34],
    BL : [12,19],
    BR : [14,28]
  },
  corner : {
    UFL : [6,45,26],
    UFR : [8,47,33],
    UBL : [0,15,20],
    UBR : [2,17,27],
    DFL : [44,51,24],
    DFR : [42,53,35],
    DBL : [38,9,18],
    DBR : [36,11,29]
  }
};

function arrayCompare(a1, a2) {
  if (typeof a1 === "undefined" || typeof a2 === "undefined") return false;
  if (a1.length != a2.length) return false;
  var arr1 = [], arr2 = [];
  for (var key in a1) arr1[key] = a1[key];
  for (var key in a2) arr2[key] = a2[key];
  arr1.sort();
  arr2.sort();
  var same = true;
  for (var i = 0; i < arr1.length; i++) {
    if (typeof arr1[i] === "object" && typeof arr2[i] === "object") {
      if (!arrayCompare(arr1[i], arr2[i])) same = false;
    }
    if (arr1[i] != arr2[i]) same = false;
  }
  return same;
}

function getSquareColors(squares) {
  var colors = [];
  for (var i = 0; i < squares.length; i++) {
    colors[i] = cube[squares[i]];
  }
  return colors;
}

function cubieIncludesFace(face, cubie) {
  for (var i = 0; i < cubie.length; i++) {
    if (Math.floor(cubie[i] / 9) == face) return true;
  }
  return false;
}

function edgeCubieOtherFace(face, cubie) {
  if (!cubieIncludesFace(face, cubie)) return false;
  if (cubie.length != 2) return false;
  if (Math.floor(cubie[0] / 9) == face) return Math.floor(cubie[1] / 9);
  return Math.floor(cubie[0] / 9);  
}

function getCubieSideColor(face, cubie) {
  if (!cubieIncludesFace(face, cubie)) return false;
  if (cubie.length == 1) return cube[cubie[0]];
  var face1 = Math.floor(cubie[0] / 9);
  var face2 = Math.floor(cubie[1] / 9);
  var face3;
  if (cubie.length == 3) face3 = Math.floor(cubie[2] / 9);
  if (face1 == face) return cube[cubie[0]];
  if (face2 == face) return cube[cubie[1]];
  if (cubie.length == 3 && face3 == face) return cube[cubie[2]];
}

function getEdgeCubie(color1, color2, asString) {
  if (typeof asString === "undefined") asString = false;
  for (var c in CUBIE.edge) {
    if (arrayCompare([color1, color2], getSquareColors(CUBIE.edge[c]))) {
      if (!asString) return CUBIE.edge[c];
      else return c;
    }
  }
  return null;
}

function getCornerCubie(color1, color2, color3, asString) {
  if (typeof asString === "undefined") asString = false;
  for (var c in CUBIE.corner) {
    if (arrayCompare([color1, color2, color3], getSquareColors(CUBIE.corner[c]))) {
      if (!asString) return CUBIE.corner[c];
      else return c;
    }
  }
  return null;
}